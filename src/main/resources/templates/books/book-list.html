<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ÎèÑÏÑú Í∏∞Ï§ÄÏ†ïÎ≥¥ Ï°∞Ìöå</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Tabulator CSS -->
    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet"/>
    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/bootstrap/tabulator_bootstrap5.min.css" rel="stylesheet"/>

    <style>
        body { display: flex; margin: 0; min-height: 100vh; background: #f8f9fa; }
        #search-form { margin-bottom: 1.5rem; }
        #book-table { overflow-x: auto; }
    </style>
</head>
<!-- ÏÇ¨Ïù¥ÎìúÎ∞î Ìè¨Ìï® -->
<div th:replace="fragments/sidebar :: sidebar"></div>

<!-- ÎèÑÏÑú Ï°∞Ìöå ÏΩòÌÖêÏ∏† -->
<div class="container-fluid" style="margin-left: 10px; padding: 10px;">
    <h2 class="mb-4">üìö ÎèÑÏÑú Í∏∞Ï§ÄÏ†ïÎ≥¥ Ï°∞Ìöå</h2>

    <form id="search-form" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label">Ï†úÎ™©</label>
            <input
                    type="text"
                    id="search-title"
                    class="form-control"
                    placeholder="Ï†úÎ™© ÏûÖÎ†•"
                    autocomplete="off"
            />
        </div>
        <div class="col-md-3">
            <label class="form-label">Ï†ÄÏûê</label>
            <input
                    type="text"
                    id="search-author"
                    class="form-control"
                    placeholder="Ï†ÄÏûê ÏûÖÎ†•"
                    autocomplete="off"
            />
        </div>
        <div class="col-md-3">
            <label class="form-label">Ï∂úÌåêÏÇ¨</label>
            <input
                    type="text"
                    id="search-publisher"
                    class="form-control"
                    placeholder="Ï∂úÌåêÏÇ¨ ÏûÖÎ†•"
                    autocomplete="off"
            />
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary">Ï°∞Ìöå</button>
        </div>
    </form>

    <div id="book-table"></div>
</div>

<!-- jQuery, Bootstrap JS, Tabulator JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
></script>
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
<script>
    $(function(){
        // 1) Í≥µÌÜµ ÏÇ¨Ïù¥ÎìúÎ∞î Î°úÎìú
        $("#sidebar").load("/fragments/sidebar.html");

        // 2) Tabulator Ï¥àÍ∏∞Ìôî (ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï†ÑÏ≤¥ Ï°∞Ìöå)
        var table = new Tabulator("#book-table", {
            ajaxURL: "/book/selectBookList",
            ajaxConfig: { method: "GET" },
            ajaxLoadOnInit: true,
            layout: "fitDataFill",
            responsiveLayout: false,
            pagination: "local",
            paginationSize: 9,
            columns: [
                { title:"ISBN",        field:"ISBN",           width:120 },
                {
                    title:"ÌëúÏßÄ",
                    field:"COVER_IMAGE",
                    width:80,
                    hozAlign:"center",
                    formatter:"image",
                    formatterParams:{ height:"60px" }
                },
                {
                    title:"Ï†úÎ™©",
                    field:"TITLE",
                    minWidth:180,
                    formatter:function(cell){
                        var full = cell.getValue(),
                            short = full.length>25?full.slice(0,25)+"‚Ä¶":full;
                        return '<a href="'+cell.getData().ALADIN_LINK+'" target="_blank" title="'+full.replace(/"/g,'&quot;')+'">'+short+'</a>';
                    }
                },
                { title:"Ï†ÄÏûê",        field:"AUTHOR",        width:140 },
                { title:"Ï∂úÌåêÏÇ¨",      field:"PUBLISHER",     width:140 },
                {
                    title:"Ï∂úÍ∞ÑÏùº",
                    field:"PUBLISH_DATE",
                    width:110,
                    hozAlign:"center",
                    formatter:function(cell){
                        var v = cell.getValue();
                        return v? new Date(v).toISOString().split("T")[0] : "";
                    }
                },
                {
                    title:"Ï†ïÍ∞Ä",
                    field:"PRICE_STANDARD",
                    width:90,
                    hozAlign:"right",
                    formatter:"money",
                    formatterParams:{ symbol:"‚Ç©", precision:0 }
                },
                {
                    title:"ÌåêÎß§Í∞Ä",
                    field:"PRICE_SALES",
                    width:90,
                    hozAlign:"right",
                    formatter:"money",
                    formatterParams:{ symbol:"‚Ç©", precision:0 }
                },
                { title:"Ïπ¥ÌÖåÍ≥†Î¶¨",    field:"CATEGORY_NAME",  minWidth:200 },
                {
                    title:"Î¶¨Î∑∞",
                    field:"REVIEW_RANK",
                    width:80,
                    hozAlign:"center",
                    formatter:function(cell){ return cell.getValue()+" / 10"; }
                }
            ]
        });

        // 3) Í≤ÄÏÉâ ÌèºÏúºÎ°ú Ï°∞Í±¥ Ï°∞Ìöå
        $("#search-form").on("submit", function(e){
            e.preventDefault();
            var params = $.param({
                title:     $("#search-title").val(),
                author:    $("#search-author").val(),
                publisher: $("#search-publisher").val()
            });
            table.setData("/book/selectBookList?" + params);
        });
    });
</script>
</body>
</html>
